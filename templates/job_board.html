{% extends "base.html" %}

{% block title %}Job Board{% endblock %}

{% block content %}
    <h1>Job Board</h1>

    <!-- Job Search Form -->
    <form action="{{ url_for('job_board') }}" method="post">
        {{ job_search_form.csrf_token }}
                
        <label for="city">City:</label>
        <input type="text" id="city" name="city" value="{{ request.form.city }}">
    
        <label for="state">State:</label>
        <input type="text" id="state" name="state" value="{{ request.form.state }}">
                
        <label for="keyword">Keyword:</label>
        {{ job_search_form.keyword(class="form-control") }}
        <button type="submit">Search</button>
    </form>
    

    {% if get_flashed_messages() %}
        <div class="flash-messages">
            {% for message in get_flashed_messages() %}
                <div class="flash-message">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

    {% if web_job_data %}
        <h2>Web Job Data</h2>
        <ul>
            {% for job in web_job_data %}
                <li>
                    <h3>{{ job['Title'] }}</h3>
                    <p><strong>Location:</strong> {{ job['Location'] }}</p>
                    <p><strong>City:</strong> {{ job.City }}</p>
                    <p><strong>State:</strong> {{ job.State }}</p>
                    <p><strong>Base Pay:</strong> {{ job['Base Pay'] }}</p>
                    <p><strong>Duties:</strong></p>
                    <ul>
                        {% for duty in job['Duties'] %}
                            <li>{{ duty }}</li>
                        {% endfor %}
                    </ul>
                    <!-- Add a link for web job details here -->
                    <a href="{{ url_for('accept_job', username=g.user.username, job_id=loop.index) }}">Accept Job</a>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No web job data available.</p>
    {% endif %}

    
    {% if db_job_data %}
    <h2>Database Job Data</h2>
    <ul>
        {% set matched_jobs = [] %} {# Create an empty list to store matched jobs #}
        {% for job in db_job_data %}
            {% if (not city_param or job.job_city == city_param) or 
                 (not state_param or job.job_state == state_param) or 
                 (not keyword or keyword in job.job_title) %}
                {% set matched_jobs = matched_jobs + [job] %} 
                
                {% set city_match = not city_param or job.job_city == city_param %}
                {% set keyword_match = not keyword or (keyword is defined and keyword in job.job_title) %}
                {% set state_match = not state_param or job.job_state == state_param %}
                
                {% if city_match or keyword_match or state_match %}
                    {% set matched_jobs = matched_jobs + [job] %} {# Add matched job to the list #}
                {% endif %}
                
                <p>Debug Info:</p>
                <ul>
                    <li>City Param: {{ city_param }}</li>
                    <li>State Param: {{ state_param }}</li>
                    <li>Keyword: {{ keyword }}</li>
                    <li>Job City: {{ job.job_city }}</li>
                    <li>Job State: {{ job.job_state }}</li>
                    </ul>




                    <li>
                        <h3>{{ job.job_title }}</h3>
                        <p><strong>Location:</strong> {{ job.job_city }}, {{ job.job_state }}</p>
                        <p><strong>Base Pay:</strong> {{ job.job_payrate }}</p>
                        <p><strong>Duties:</strong></p>
                        <ul>
                            {% for duty in job.job_duties.split(',') %}
                                <li>{{ duty }}</li>
                            {% endfor %}
                        </ul>
                        <!-- Add a link for database job details here -->
                        <a href="{{ url_for('accept_job', username=g.user.username, job_id=job.id) }}">Accept Job</a>
                    </li>

                    
            {% endif %}
            



        {% if matched_jobs %}

            {% for job in matched_jobs %}
                <li>
                    <h3>{{ job.job_title }}</h3>
                    <p><strong>Location:</strong> {{ job.job_city }}, {{ job.job_state }}</p>
                    <p><strong>Base Pay:</strong> {{ job.job_payrate }}</p>
                    <p><strong>Duties:</strong></p>
                    <ul>
                        {% for duty in job.job_duties.split(',') %}
                            <li>{{ duty }}</li>
                        {% endfor %}
                    </ul>
                    <!-- Add a link for database job details here -->
                    <a href="{{ url_for('accept_job', username=g.user.username, job_id=job.id) }}">Accept Job</a>
                </li>
            {% endfor %}

        {% else %}
            <p>No matching job data available.</p>
        {% endif %}


        {% endfor %}

    <!-- {% for job in db_job_data %}
    <li>
        <h3>{{ job.job_title }}</h3>
        <p>Debug Info:</p>
        <ul>
            <li>City Param: {{ city_param }}</li>
            <li>State Param: {{ state_param }}</li>
            <li>Keyword: {{ keyword }}</li>
            <li>Job City: {{ job.job_city }}</li>
            <li>Job State: {{ job.job_state }}</li>
        </ul>
    

        
    </li>
{% endfor %} -->


    <!-- {% for job in db_job_data %}
        {% set city_match = not city_param or job.job_city == city_param %}
        {% set keyword_match = not keyword or (keyword is defined and keyword in job.job_title) %}
        {% set state_match = not state_param or job.job_state == state_param %}
        
        {% if city_match or keyword_match or state_match %}
            {% set matched_jobs = matched_jobs + [job] %} {# Add matched job to the list #}
        {% endif %}

    {% endfor %}
     -->



    </ul>
{% else %}
    <p>No database job data available.</p>
{% endif %}


    



</div>

{% endblock %}
